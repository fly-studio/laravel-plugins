/*! menu.js 2016-10-28 17:20:21*/
var $app=angular.module("app");$app.requires=["jquery","ui.bootstrap","untils","ngInputModified","ng.ueditor"],$app.config(function(e){e.disableGlobally()}).directive("menuController",function(){return{restrict:"A",controller:"menuController",replace:!0,scope:!0,templateUrl:function(e,n){return n.templateUrl||"wechat/menu"}}}).controller("menuController",function(e,n){e.forms={},e.submiting=!1,e.dataList=menuList?menuList.data:[],e.menuSelected=null,e.deletedList=[];for(var t=0;t<e.dataList.length;++t)if(e.dataList[t].index=t+1,e.dataList[t].children)for(var i=0;i<e.dataList[t].children.length;i++)e.dataList[t].children[i].index=10*(t+1)+(i+1);e.select=function(n){e.menuSelected=n};var r=-1;e.create=function(n,t,i){var a={id:r--,pid:t.toString(),title:"",type:"view",url:"",order:n.length+1,children:[],index:10*i+(n.length+1)};n.push(a),e.select(n[n.length-1])},e.saveMenus=function(){var t=[];return e.forms.menu&&angular.forEach(e.forms.menu,function(i,r){if(i){var a=jQuery('[name="'+i.$name+'"]'),u=r>10?e.dataList[parseInt(r/10)-1].children[r%10-1]:e.dataList[r-1];t.push(n.form(a,function(n){if("success"==n.result){if(u.id=n.data.id,u.children)for(var t=0;t<u.children.length;t++)u.children[t].pid=u.id;i.$setPristine(),e.$apply()}},!1).fail(function(n){e.select(u),jQuery.showtips(n)}).done(function(e){}))}}),jQuery.when.apply(this,t)},e.save=function(){var t=function(){n.form(jQuery('[name="forms.publish"]')).done(function(e){$.showtips(e)}).always(function(){e.submiting=!1})};e.submiting=!0,e.saveMenus().done(t).fail(function(){e.submiting=!1})},e.destroy=function(n,t){jQuery.confirm("\u60a8\u786e\u5b9a\u5220\u9664\u6b64\u9879\u5417\uff1f",function(){for(var i=0;i<t.length;i++)t[i].index>n.index&&t[i].index--;n.id>0&&e.deletedList.push(n.id),t.splice(n.index%10-1,1),e.$apply()})}});