/*! menu.js 2016-10-28 18:07:40*/
var $app=angular.module("app");$app.requires=["jquery","ui.bootstrap","untils","ngInputModified","ng.ueditor"],$app.config(["inputModifiedConfigProvider",function(e){e.disableGlobally()}]).directive("menuController",function(){return{restrict:"A",controller:"menuController",replace:!0,scope:!0,templateUrl:function(e,n){return n.templateUrl||"wechat/menu"}}}).controller("menuController",["$scope","$query",function(e,n){e.forms={},e.submiting=!1,e.dataList=menuList?menuList.data:[],e.menuSelected=null,e.deletedList=[];for(var i=0;i<e.dataList.length;++i)if(e.dataList[i].index=i+1,e.dataList[i].children)for(var t=0;t<e.dataList[i].children.length;t++)e.dataList[i].children[t].index=10*(i+1)+(t+1);e.select=function(n){e.menuSelected=n};var r=-1;e.create=function(n,i,t){var a={id:r--,pid:i.toString(),title:"",type:"view",url:"",order:n.length+1,children:[],index:10*t+(n.length+1)};n.push(a),e.select(n[n.length-1])},e.saveMenus=function(){var i=[];return e.forms.menu&&angular.forEach(e.forms.menu,function(t,r){if(t){var a=jQuery('[name="'+t.$name+'"]'),u=r>10?e.dataList[parseInt(r/10)-1].children[r%10-1]:e.dataList[r-1];i.push(n.form(a,function(n){if("success"==n.result){if(u.id=n.data.id,u.children)for(var i=0;i<u.children.length;i++)u.children[i].pid=u.id;t.$setPristine(),e.$apply()}},!1).fail(function(n){e.select(u),jQuery.showtips(n)}).done(function(e){}))}}),jQuery.when.apply(this,i)},e.save=function(){var i=function(){n.form(jQuery('[name="forms.publish"]')).done(function(e){$.showtips(e)}).always(function(){e.submiting=!1})};e.submiting=!0,e.saveMenus().done(i).fail(function(){e.submiting=!1})},e.destroy=function(n,i){jQuery.confirm("\u60a8\u786e\u5b9a\u5220\u9664\u6b64\u9879\u5417\uff1f",function(){for(var t=0;t<i.length;t++)i[t].index>n.index&&i[t].index--;n.id>0&&e.deletedList.push(n.id),i.splice(n.index%10-1,1),e.$apply()})}}]);