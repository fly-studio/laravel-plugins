/*! role.js 2016-11-10 19:07:39*/
!function(e){e().ready(function(){var a={};a.show=function(a){e(".tab-pane").hide(),e("#role-"+a).show()},a.create=function(o){return o?(a.show(o),e("#edit-modal").modal({backdrop:"static"}),e("#name,#display_name,#description,#url").prop("disabled",!1).val(""),e("#pid").val(o).trigger("change").prop("disabled",!0),e("#pid1").val(o),void e("#edit-form").attr("action",e.baseuri+"admin/role").find('[name="_method"]').val("POST")):(e.alert("\u60a8\u65e0\u6cd5\u521b\u5efa\u9876\u7ea7\u7528\u6237\u7ec4\uff0c\u5982\u679c\u4f60\u662f\u7ba1\u7406\u5458\uff0c\u8bf7\u5728\u6570\u636e\u5e93\u4e2d\u64cd\u4f5c\u3002"),!1)},a.edit=function(o){a.show(o),e("#edit-modal").modal({backdrop:"static"});var t=e("#role-"+o);["name","display_name","description","url"].forEach(function(a){e("#"+a).val(e('[name="'+a+'"]',t).val())}),e("#pid").val(e('[name="pid"]',t).val()).trigger("change").prop("disabled",!0),e("#pid1").val(0),e("#name").prop("disabled",!0),e("#edit-form").attr("action",e.baseuri+"admin/role/"+o).find('[name="_method"]').val("PUT")},a.remove=function(o){a.show(o);var t=e("#role-"+o);e("#delete-modal").modal({backdrop:"static"}),e("#delete-form").attr("action",e.baseuri+"admin/role/"+o),e("#role_name").text(t.data("role_name")),e("#original_role_id").val(e(this).data("role_id"))},a.addHoverDom=function(o,t){var r=e("#"+t.tId+"_span");if(!(t.editNameFlag||e("#addBtn_"+t.tId).length>0)&&$zTree.setting.edit.enable){var n="<span class='button add' id='addBtn_"+t.tId+"' title='\u6dfb\u52a0\u5b50\u7528\u6237\u7ec4' onfocus='this.blur();'></span>";r.after(n);var d=e("#addBtn_"+t.tId);d.off("click").on("click",function(){return $zTree.selectNode(t),a.create(t.id),!1})}},a.removeHoverDom=function(a,o){e("#addBtn_"+o.tId).off().remove()},a.showRemoveBtn=function(e,a){return!a.isParent&&0!==a.level},a.beforeRemove=function(a,o){$zTree.selectNode(o),console.log();var t=e('[name="delete-modal"]',"#role-"+o.id);return t.length<1?(e.alert("\u8be5\u7528\u6237\u7ec4\u4e0d\u80fd\u88ab\u5220\u9664"),!1):(e('[name="delete-modal"]',"#role-"+o.id).triggerHandler("click"),!1)},a.beforeRename=function(e,a){return!1},a.onclick=function(e,o,t){0!==t.id&&a.show(t.id)};var o={view:{addHoverDom:a.addHoverDom,removeHoverDom:a.removeHoverDom,selectedMulti:!1},edit:{enable:!0,editNameSelectAll:!0,removeTitle:"\u5220\u9664\u6b64\u9879",showRemoveBtn:a.showRemoveBtn,showRenameBtn:!1,drag:!1},callback:{beforeDrag:a.beforeDrag,beforeDrop:a.beforeDrop,beforeRemove:a.beforeRemove,beforeRename:a.beforeRename,onClick:a.onclick},data:{simpleData:{enable:!0,idKey:"id",pIdKey:"pid",rootPId:0},key:{name:"display_name"}}};$zTree=e.fn.zTree.init(e("#tree"),o,TreeData),$zTree.expandAll(!0);var t=$zTree.getNodeByParam("name","super");$zTree.selectNode(t),$zTree.expandNode(t,!0),a.show(t.id),e('[name="edit-modal"]').on("click",function(){var o=e(this).closest(".tab-pane").data("id");return a.edit(o),!1}),e('[name="create-modal"]').on("click",function(){var o=e(this).closest(".tab-pane").data("id");return a.create(o),!1}),e('[name="delete-modal"]').on("click",function(){var o=e(this).closest(".tab-pane").data("id");return a.remove(o),!1})})}(jQuery);